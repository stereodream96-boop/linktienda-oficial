Proyecto: Link Tienda ‚Äî Resumen y volcado de archivos
Fecha: 27 de diciembre de 2025

Objetivo
- Documentar los cambios recientes y volcar en este fichero (`chatgpt.txt`) el contenido de los archivos clave editados en el frontend.

Resumen de cambios recientes
- Elimin√© renderizados de debug visibles en la vista p√∫blica (n√∫meros, badges y `<pre>` con JSON).
- Limpi√© `StoreHeader` para que muestre √∫nicamente el logo y el nombre de la tienda (prioriza `contact.store_name`, evita slugs num√©ricos).
- Mov√≠ el `<header>` para que sea hermano de `.public-container` y elimin√© el `<h1>` que aparec√≠a dentro del header.
- A√±ad√≠ estilos de layout tipo tarjetas (`.card`, `.card-grid`) y defin√≠ `body { margin: 0 }` para evitar espacios no deseados.
- Normalic√© la l√≥gica de rutas de im√°genes (`logo_url`) para aceptar rutas relativas devueltas por el backend.

Archivos clave y contenidos (copias tomadas del workspace en este momento)

--- `frontend/src/PageViewer.jsx` ---

(Contenido completo)

import React, { useEffect, useState } from 'react'
import * as api from './components/admin/adminApi'
import { Link } from 'react-router-dom'
import StoreHeader from './components/public/StoreHeader'

export default function PageViewer({ slug = null }) {
  // PageViewer ahora solo maneja la home p√∫blica de la tienda: /:storeSlug
  // `slug` viene desde el wrapper de rutas en App.jsx
  const [page, setPage] = useState(null)
  const [imgIndex, setImgIndex] = useState(0)
  const [sections, setSections] = useState([])
  const [sectionProducts, setSectionProducts] = useState({})
  const [sectionLoading, setSectionLoading] = useState({})
  const [sectionError, setSectionError] = useState({})
  const [services, setServices] = useState([])
  const [searchTerm, setSearchTerm] = useState('')

  useEffect(() => {
    async function load() {
      try {
        if (slug) {
          const res = await fetch('http://localhost/LinkTiendas/Link%20Tienda/backend/api/pages.php?slug=' + encodeURIComponent(slug))
          if (!res.ok) { setPage(null); return }
          const data = await res.json()
          setPage(data.page || null)
        } else {
          const res = await fetch('http://localhost/LinkTiendas/Link%20Tienda/backend/api/pages.php')
          if (!res.ok) return
          const data = await res.json()
          setPage((data.pages && data.pages[0]) || null)
        }
      } catch (e) { }
    }
    load()
  }, [slug])

  useEffect(() => {
    if (!page) return
    let secs = []
    if (page.sections_json) {
      if (typeof page.sections_json === 'string') {
        try { secs = JSON.parse(page.sections_json) } catch (e) { secs = [] }
      } else if (Array.isArray(page.sections_json)) secs = page.sections_json
    }
    setSections(secs || [])

    if (page.page_type && page.page_type.toLowerCase().includes('serv')) {
      (async () => {
        try {
          const data = await api.getServices(page.id)
          if (data && data.ok) setServices(data.services || [])
        } catch (e) { }
      })()
    }
  }, [page])

  useEffect(() => {
    if (!page || !page.id) return
    if (!sections || sections.length === 0) return
    sections.forEach((sec, idx) => {
      const key = idx
      if (sectionProducts[key] && Array.isArray(sectionProducts[key])) return
      let url = `http://localhost/LinkTiendas/Link%20Tienda/backend/api/inventory.php?page_id=${page.id}`
      const val = (typeof sec === 'string') ? sec : (sec.value || '')
      const vLower = (val || '').toLowerCase()
      if (vLower.includes('oferta') || vLower.includes('ofertas') || vLower.includes('destac')) {
        url += '&filter=offers'
      } else if (vLower.startsWith('category:')) {
        const cat = val.split(':').slice(1).join(':').trim()
        url += `&filter=category&category=${encodeURIComponent(cat)}`
      } else {
        const cats = Array.isArray(page.categories) ? page.categories : []
        if (cats.includes(val)) {
          url += `&filter=category&category=${encodeURIComponent(val)}`
        } else {
          url += `&filter=category&category=${encodeURIComponent(val)}`
        }
      }

      setSectionLoading(s => ({ ...s, [key]: true }))
      fetch(url).then(r => r.json()).then(data => {
        if (data && data.ok) {
          setSectionProducts(sp => ({ ...sp, [key]: data.products || [] }))
          setSectionError(se => ({ ...se, [key]: null }))
        } else {
          setSectionProducts(sp => ({ ...sp, [key]: [] }))
          setSectionError(se => ({ ...se, [key]: data && data.message ? data.message : 'Error cargando productos' }))
        }
      }).catch(err => {
        setSectionProducts(sp => ({ ...sp, [key]: [] }))
        setSectionError(se => ({ ...se, [key]: 'Error de red' }))
      }).finally(() => setSectionLoading(s => ({ ...s, [key]: false })))
    })
  }, [sections, page])

  if (!page) return <div style={{ padding: 20 }}>Cargando contenido...</div>

  const imgs = Array.isArray(page.images) ? page.images : []
  const cats = Array.isArray(page.categories) ? page.categories : []
  const contact = page.contact_info || {}

  function prevImg() { setImgIndex((i) => (i - 1 + imgs.length) % imgs.length) }
  function nextImg() { setImgIndex((i) => (i + 1) % imgs.length) }

  return (
    <>
      <header>
        <StoreHeader page={page} storeSlug={slug} onSearch={setSearchTerm} />
      </header>

      <div className="public-container">
        {imgs && imgs.length > 0 && (
          <div style={{ position: 'relative', marginBottom: 12 }}>
            <img src={imgs[imgIndex]} alt="hero" style={{ width: '100%', height: 300, objectFit: 'cover', borderRadius: 6 }} />
            <button onClick={prevImg} style={{ position: 'absolute', left: 10, top: '50%', transform: 'translateY(-50%)' }}>{'‚Äπ'}</button>
            <button onClick={nextImg} style={{ position: 'absolute', right: 10, top: '50%', transform: 'translateY(-50%)' }}>{'‚Ä∫'}</button>
          </div>
        )}

        <div style={{ marginBottom: 12 }}>
        {cats.length > 0 ? (
          cats.map((c, i) => (
            <button key={i} onClick={() => {}} style={{ marginRight: 8, marginBottom: 8, padding: '6px 10px', background: '#f5f5f5' }}>{c}</button>
          ))
        ) : (
          <div style={{ color: '#666' }}>Sin categor√≠as</div>
        )}
      </div>

      {page.page_type && page.page_type.toLowerCase().includes('serv') ? (
        <section style={{ marginBottom: 20 }}>
          <h3>P√°gina de servicios</h3>
          {services.length === 0 ? <div>No hay servicios publicados.</div> : (
            <div className="card-grid services-grid">
              {services.filter(s => {
                if (!searchTerm) return true
                const q = searchTerm.toLowerCase()
                return (s.name && s.name.toLowerCase().includes(q)) || (s.description && s.description.toLowerCase().includes(q))
              }).map(s => {
                const to = `/${page.slug || page.id}/service/${s.id}`
                return (
                  <Link key={s.id} to={to} target="_blank" rel="noreferrer" style={{ textDecoration: 'none', color: 'inherit' }}>
                    <div className="card">
                      <div className="card-title">{s.name}</div>
                      <div className="card-meta">{s.duration_minutes} min - ${s.price}</div>
                    </div>
                  </Link>
                )
              })}
            </div>
          )}
        </section>
      ) : (
        sections.map((sec, idx) => {
          const key = idx
          const val = (typeof sec === 'string') ? sec : (sec.value || '')
          const title = sec.title || val || `Secci√≥n ${idx+1}`
          const items = sectionProducts[key] || []
          const loading = !!sectionLoading[key]
          const error = sectionError[key]
          return (
            <section key={key} style={{ marginBottom: 20 }}>
              <h3>{title}</h3>
              {loading ? <div>Cargando productos...</div> : error ? <div style={{ color: '#c55' }}>Error cargando productos</div> : (
                items.length === 0 ? <div style={{ color: '#666' }}>No hay productos para mostrar.</div> : (
                  <div className="card-grid">
                    {items.filter(p => {
                      if (!searchTerm) return true
                      const q = searchTerm.toLowerCase()
                      return (p.name && p.name.toLowerCase().includes(q)) || (p.category && p.category.toLowerCase().includes(q))
                    }).map(p => {
                      const to = `/${page.slug || page.id}/product/${p.id}`
                      return (
                        <Link key={p.id} to={to} target="_blank" rel="noreferrer" style={{ textDecoration: 'none', color: 'inherit' }}>
                          <div className="card">
                            <div className="card-title">{p.name}</div>
                            <div className="card-meta">{p.on_sale && p.sale_price ? (
                              <span><span style={{ textDecoration: 'line-through', marginRight: 6 }}>${p.price}</span><strong>${p.sale_price}</strong></span>
                            ) : (<span>${p.price}</span>)}</div>
                            <div className="card-labels">
                              {p.on_sale ? <span style={{ marginRight: 8, color: '#c55' }}>Oferta</span> : null}
                              {p.featured ? <span style={{ marginRight: 8, color: '#2a9d8f' }}>Destacado</span> : null}
                              {p.category ? <span style={{ marginRight: 8 }}>{p.category}</span> : null}
                            </div>
                          </div>
                        </Link>
                      )
                    })}
                  </div>
                )
              )}
            </section>
          )
        })
      )}

      <article style={{ marginBottom: 30 }} dangerouslySetInnerHTML={{ __html: page.content }} />

      <footer style={{ borderTop: '1px solid #eee', paddingTop: 12 }}>
        <div style={{ fontWeight: 'bold' }}>{contact.store_name || ''}</div>
        <div style={{ marginTop: 6 }}>
          {contact.whatsapp && <div>WhatsApp: <a href={`https://wa.me/${contact.whatsapp}`}>{contact.whatsapp}</a></div>}
          {contact.address && <div>Direcci√≥n: {contact.address}</div>}
          {contact.instagram && <div>Instagram: <a href={`https://instagram.com/${contact.instagram.replace(/^@/, '')}`}>{contact.instagram}</a></div>}
        </div>
      </footer>
      </div>
    </>
  )
}

--- `frontend/src/components/public/StoreHeader.jsx` ---

(Contenido completo)

import React, { useState, useEffect } from 'react'
import styles from './StoreHeader.module.css'

export default function StoreHeader({ page = {}, storeSlug = '', onSearch = null }){
  const [search, setSearch] = useState('')

  useEffect(()=>{
    if (onSearch) onSearch(search)
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [search])

  const contact = (page && page.contact_info) || {}
  // prefer contact.store_name, otherwise page.title only if not equal to numeric slug
  const pageTitle = page && page.title ? String(page.title) : ''
  const safeTitle = (pageTitle && pageTitle !== storeSlug && !/^\d+$/.test(pageTitle)) ? pageTitle : ''
  const storeName = contact.store_name || safeTitle || 'Tienda'
  const logoUrl = page && page.logo_url ? page.logo_url : null
  // normalize logo src: if backend returned a relative path, make it absolute
  let logoSrc = null
  if (logoUrl) {
    try {
      const isAbsolute = /^(https?:)?\/\//.test(logoUrl)
      if (isAbsolute) logoSrc = logoUrl
      else {
        const rel = logoUrl.replace(/^\//, '')
        logoSrc = window.location.origin + '/' + rel
      }
    } catch (e) {
      logoSrc = logoUrl
    }
  }

  function initials(name){
    if(!name) return 'T'
    const parts = name.trim().split(/\s+/)
    if(parts.length === 1) return parts[0].slice(0,2).toUpperCase()
    return (parts[0][0] + parts[1][0]).toUpperCase()
  }

  return (
    <div className={styles.storeHeader}>
      <div className={styles.topBar}>
        <div className={styles.topLeft}>
          <a href="#" className={styles.topLink}>Centro de ayuda</a>
          <a href="#" className={styles.topLink}>Testimonios</a>
        </div>
        <div className={styles.topRight}>COMPR√Å POR MAYOR - CONSULT√Å CON DESCUENTO</div>
      </div>

      <div className={styles.mainBar}>
        <div className={styles.container}>
          <div className={styles.brand}>
            {logoSrc ? (
              <img src={logoSrc} alt="logo" className={styles.logo} />
            ) : (
              <div className={styles.logoPlaceholder}>{initials(storeName)}</div>
            )}
            <div className={styles.brandText}>
              <div className={styles.brandName}>{storeName}</div>
            </div>
          </div>

          <div className={styles.searchWrap}>
            <div className={styles.searchIcon} aria-hidden>üîç</div>
            <input className={styles.searchInput} placeholder="¬øQu√© est√°s buscando?" value={search} onChange={e=>setSearch(e.target.value)} />
          </div>

          <div className={styles.actions}>
            <button className={styles.actionBtn}>Cuenta</button>
            <button className={styles.actionBtn}>Carrito (0)</button>
          </div>
        </div>
      </div>
    </div>
  )
}

--- `frontend/src/components/public/ServiceDetail.jsx` ---

(Contenido completo)

import React, { useEffect, useState } from 'react'
import * as api from '../../components/admin/adminApi'

export default function ServiceDetail({ store, serviceId }){
  const [service, setService] = useState(null)
  const [page, setPage] = useState(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)
  const [date, setDate] = useState('')
  const [slots, setSlots] = useState([])
  const [selectedSlot, setSelectedSlot] = useState(null)
  const [reservedMap, setReservedMap] = useState({})
  const [capacityMap, setCapacityMap] = useState({})
  const [name, setName] = useState('')
  const [phone, setPhone] = useState('')
  const [resStatus, setResStatus] = useState(null)
  const [resLoading, setResLoading] = useState(false)

  useEffect(()=>{
    let mounted = true
    async function load(){
      try{
        const s = await api.getService(serviceId)
        if (!mounted) return
        if (!s || !s.ok) { setError(s && s.message ? s.message : 'Servicio no encontrado'); setLoading(false); return }
        setService(s.service)
        if (store) {
          try{ const sp = await fetch(`http://localhost/LinkTiendas/Link%20Tienda/backend/api/pages.php?slug=${encodeURIComponent(store)}`)
            if (sp.ok){ const dd = await sp.json(); setPage(dd.page || null) }
          }catch(e){}
      }catch(e){ setError('Error de red') }
      setLoading(false)
    }
    load()
    return ()=>{ mounted = false }
  }, [store, serviceId])

  async function loadSlotsForDate(d){
    if (!page || !page.id) return
    setSlots([]); setSelectedSlot(null)
    try{
      const resp = await api.getTurns(page.id, d, d)
      if (!resp || !resp.ok) { setSlots([]); return }
      const all = resp.turns || []
      const filtered = all.filter(t => Number(t.service_id) === Number(serviceId))
      if (filtered.length > 0) {
        setSlots(filtered)
        const cmap = {}
        filtered.forEach(t => {
          if (t.start_time) {
            const k = (t.start_time || '').toString().slice(0,5)
            cmap[k] = t.capacity ? parseInt(t.capacity) : null
          }
        })
        setCapacityMap(cmap)
      } else {
        const gen = []
        try {
          const duration = service && service.duration_minutes ? parseInt(service.duration_minutes) : null
          const open = page.open_time || null
          const close = page.close_time || null
          if (duration && open && close) {
            const startDt = new Date(d + 'T' + (open.length===8 ? open : open + ':00'))
            const closeDt = new Date(d + 'T' + (close.length===8 ? close : close + ':00'))
            let cur = new Date(startDt)
            let idx = 0
            while (true) {
              const end = new Date(cur.getTime() + duration * 60000)
              if (end > closeDt) break
              const hh = String(cur.getHours()).padStart(2,'0') + ':' + String(cur.getMinutes()).padStart(2,'0')
              gen.push({ id: `gen-${idx}-${hh}`, page_id: page.id, service_id: serviceId, date: d, start_time: hh, end_time: end.toTimeString().split(' ')[0] })
              idx++
              cur = new Date(cur.getTime() + duration * 60000)
            }
          }
        } catch(e) { }
        setSlots(gen)
        setCapacityMap({})
      }
      try{
        const r = await api.getReservations(page.id, serviceId, d)
        if (r && r.ok) {
          const map = {}
          if (Array.isArray(r.reservations) && r.reservations.length > 0) {
            r.reservations.forEach(rr => {
              const st = (rr.start_time||'').toString().slice(0,5)
              if (!st) return
              map[st] = (map[st]||0) + 1
            })
          } else if (r.reservedMap && typeof r.reservedMap === 'object') {
            Object.keys(r.reservedMap).forEach(k => {
              const st = (k||'').toString().slice(0,5)
              if (!st) return
              map[st] = 1
            })
          }
          setReservedMap(map)
        } else {
          setReservedMap({})
        }
      }catch(e){ setReservedMap({}) }
    }catch(e){ setSlots([]) }
  }

  useEffect(()=>{
    if (date && page && page.id) { loadSlotsForDate(date) }
  }, [page, date])

  async function confirmReservation(){
    if (!selectedSlot) { setResStatus({ ok:false, message:'Seleccione un horario' }); return }
    try{
      setResLoading(true)
      const payload = { service_id: serviceId, date: selectedSlot.date, start_time: selectedSlot.start_time, customer_name: name, customer_phone: phone }
      const res = await api.createReservation(page.id, payload)
      setResStatus(res)
      if (res && res.ok) { await loadSlotsForDate(selectedSlot.date) }
      setResLoading(false)
    }catch(e){ setResStatus({ ok:false, message:'Error de red' }) }
  }

  if (loading) return <div style={{ padding: 20 }}>Cargando...</div>
  if (error) return <div style={{ padding: 20, color: '#c55' }}>{error}</div>
  if (!service) return <div style={{ padding: 20 }}>Servicio no encontrado</div>

  return (
    <div style={{ maxWidth: 1000, margin: '0 auto', padding: 20 }}>
      <header style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
        {page && page.logo_url && <img src={page.logo_url} alt="logo" style={{ width:64,height:64,objectFit:'cover',borderRadius:8 }} />}
        <div>
          <h2 style={{ margin:0 }}>{service.name}</h2>
          <div style={{ color:'#666' }}>{service.duration_minutes} min ¬∑ {service.price ? `$${service.price}` : 'Precio no disponible'}</div>
        </div>
      </header>

      <main style={{ display:'grid', gridTemplateColumns:'1fr 360px', gap:20, marginTop:12 }}>
        <div>
          <h3>Descripci√≥n</h3>
          <div>{service.description || 'Sin descripci√≥n.'}</div>
        </div>
        <aside style={{ border:'1px solid #eee', padding:12, borderRadius:8 }}>
          <h4>Reservar</h4>
          <div style={{ marginBottom:8 }}>
            <label>Fecha</label>
            <input type="date" value={date} onChange={e=>{ setDate(e.target.value); loadSlotsForDate(e.target.value) }} style={{ width:'100%', padding:8, marginTop:6 }} />
          </div>
          <div style={{ marginBottom:8 }}>
            <label>Horarios</label>
            <div style={{ display:'flex', flexWrap:'wrap', gap:8, marginTop:6 }}>
              {slots.length === 0 ? <div style={{ color:'#666' }}>Seleccione una fecha para ver horarios</div> : slots.map(s => {
                const rawStart = (s.start_time||'').toString()
                const st = rawStart.slice(0,5)
                const reservedCount = (reservedMap[st] || reservedMap[rawStart] || reservedMap[st+':00'] || 0)
                const capacity = (capacityMap[st] || capacityMap[rawStart] || capacityMap[st+':00'] || null)
                const isFull = capacity && capacity > 0 && reservedCount >= capacity
                const isReserved = reservedCount > 0
                const isSelected = selectedSlot && selectedSlot.id === s.id
                const disabled = isFull || isReserved
                let bg = '#f5f5f5'
                let color = '#000'
                if (isSelected) { bg = '#2a9d8f'; color = '#fff' }
                else if (isFull) { bg = '#9b2b2b'; color = '#fff' }
                else if (isReserved) { bg = '#c0392b'; color = '#fff' }
                return (
                  <button key={s.id} onClick={()=>{ if (!disabled) setSelectedSlot(s) }} disabled={disabled} className={disabled ? 'reservado' : ''} aria-disabled={disabled} style={{ padding:'6px 10px', background: bg, color, border:'none', borderRadius:6, cursor: disabled ? 'not-allowed' : 'pointer', opacity: disabled ? 0.9 : 1 }}>{s.start_time}</button>
                )
              })}
            </div>
          </div>
          <div style={{ marginBottom:8 }}>
            <input placeholder="Nombre (opcional)" value={name} onChange={e=>setName(e.target.value)} style={{ width:'100%', padding:8, marginBottom:8 }} />
            <input placeholder="Tel√©fono (opcional)" value={phone} onChange={e=>setPhone(e.target.value)} style={{ width:'100%', padding:8 }} />
          </div>
          <div>
            <button onClick={confirmReservation} style={{ width:'100%', padding:10, background:'#2a9d8f', color:'#fff', border:'none', borderRadius:6 }}>Confirmar reserva</button>
          </div>
          {resStatus ? (<div style={{ marginTop:8, color: resStatus.ok ? '#2a9d8f' : '#c55' }}>{resStatus.ok ? 'Reserva confirmada' : (resStatus.message || 'Error')}</div>) : null}
        </aside>
      </main>
    </div>
  )
}

--- `frontend/src/components/public/ProductDetail.jsx` ---

(Contenido completo)

import React, { useEffect, useState } from 'react'
import * as api from '../../components/admin/adminApi'

export default function ProductDetail({ store, productId }) {
  const [product, setProduct] = useState(null)
  const [storePage, setStorePage] = useState(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)

  useEffect(() => {
    let mounted = true
    async function load(){
      try{
        const p = await api.getProduct(productId)
        if (!mounted) return
        if (!p || !p.ok) { setError(p && p.message ? p.message : 'Producto no encontrado'); setLoading(false); return }
        setProduct(p.product)
        if (store) {
          try {
            const sp = await fetch(`http://localhost/LinkTiendas/Link%20Tienda/backend/api/pages.php?slug=${encodeURIComponent(store)}`)
            if (sp.ok){ const dd = await sp.json(); setStorePage(dd.page || null) }
          } catch(e) {}
        }
      }catch(e){ setError('Error de red') }
      setLoading(false)
    }
    load()
    return () => { mounted = false }
  }, [store, productId])

  if (loading) return <div style={{ padding: 20 }}>Cargando...</div>
  if (error) return <div style={{ padding: 20, color: '#c55' }}>{error}</div>
  if (!product) return <div style={{ padding: 20 }}>Producto no encontrado</div>

  const img = product.image_url || (storePage && storePage.logo_url) || '/backend/uploads/placeholder.png'
  const price = product.on_sale && product.sale_price ? product.sale_price : product.price

  return (
    <div style={{ maxWidth: 900, margin: '0 auto', padding: 20 }}>
      <header style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
        {storePage && storePage.logo_url && <img src={storePage.logo_url} alt="logo" style={{ width: 64, height: 64, objectFit: 'cover', borderRadius: 8 }} />}
        <div>
          <h2 style={{ margin: 0 }}>{product.name}</h2>
          <div style={{ color: '#666' }}>{product.category || 'Sin categor√≠a'}</div>
        </div>
      </header>

      <main style={{ display: 'grid', gridTemplateColumns: '1fr 320px', gap: 20, marginTop: 16 }}>
        <div>
          <img src={img} alt={product.name} style={{ width: '100%', height: 420, objectFit: 'cover', borderRadius: 8 }} />
          <div style={{ marginTop: 12 }}>
            <h3>Descripci√≥n</h3>
            <div style={{ color: '#333' }}>{product.description || 'Sin descripci√≥n disponible.'}</div>
          </div>
        </div>
        <aside style={{ border: '1px solid #eee', padding: 12, borderRadius: 8 }}>
          <div style={{ fontSize: 18, fontWeight: 'bold' }}>${price}</div>
          {product.on_sale && product.sale_price ? <div style={{ color: '#c55' }}>Oferta: ${product.sale_price}</div> : null}
          <div style={{ marginTop: 12 }}>
            <a href={storePage && storePage.contact_info && storePage.contact_info.whatsapp ? `https://wa.me/${storePage.contact_info.whatsapp}?text=${encodeURIComponent('Quiero comprar: ' + product.name)}` : '#'}>
              <button style={{ width: '100%', padding: '10px 12px', background: '#2a9d8f', color: '#fff', borderRadius: 6, border: 'none' }}>Comprar / WhatsApp</button>
            </a>
          </div>
        </aside>
      </main>
    </div>
  )
}

--- `frontend/src/App.jsx` ---

(Contenido completo)

import React, { useEffect, useState } from 'react'
import { Routes, Route, Link } from 'react-router-dom'
import Admin from './Admin'
import PageViewer from './PageViewer'
import ProductDetail from './components/public/ProductDetail'
import ServiceDetail from './components/public/ServiceDetail'
import { useParams } from 'react-router-dom'

export default function App(){
  const [pages, setPages] = useState([])

  useEffect(()=>{
    async function load(){
      try{ const res = await fetch('http://localhost/LinkTiendas/Link%20Tienda/backend/api/pages.php'); if(!res.ok) return; const data = await res.json(); setPages(data.pages || []) }catch(e){}
    }
    load()
  },[])

  const visiblePages = (pages || []).filter(p => !(p.title && /^\d+$/.test(String(p.title))))

  return (
    <div style={{ padding: 0 }}>
      {visiblePages.length > 0 ? (
        <header style={{ marginBottom: 16 }}>
          <nav style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
            {visiblePages.map(p => (
              <Link key={p.id} to={`/${p.slug}`} style={{ padding: '6px 10px', background: '#f0f0f0', borderRadius: 4, textDecoration: 'none', color: '#111' }}>{p.title}</Link>
            ))}
          </nav>
        </header>
      ) : null}

      <main>
        <Routes>
          <Route path="/admin/*" element={<Admin/>} />
          <Route path="/:storeSlug/service/:serviceId" element={<ServiceDetailWrapper/>} />
          <Route path="/:storeSlug/product/:productId" element={<ProductDetailWrapper/>} />
          <Route path="/:storeSlug" element={<PageViewerWrapper/>} />
          <Route path="/" element={<div>Landing ‚Äî seleccione una tienda</div>} />
        </Routes>
      </main>
    </div>
  )
}

function PageViewerWrapper(){
  const { storeSlug } = useParams()
  return <PageViewer slug={storeSlug} />
}

function ProductDetailWrapper(){
  const { storeSlug, productId } = useParams()
  return <ProductDetail store={storeSlug} productId={productId} />
}

function ServiceDetailWrapper(){
  const { storeSlug, serviceId } = useParams()
  return <ServiceDetail store={storeSlug} serviceId={serviceId} />
}

Notas finales
- Si quer√©s que incluya m√°s archivos completos (por ejemplo `styles.css`, `StoreHeader.module.css`, o scripts en `backend/api/`), lo agrego en una nueva versi√≥n del `chatgpt.txt`.
- Si el "1" que viste persiste, puede provenir del backend; puedo ejecutar una b√∫squeda adicional en `backend/**` o revisar respuestas reales desde el endpoint para ver contenido crudo.

Fin del volcado.


----------------------------------------
File: frontend/index.html
Path: frontend/index.html
Description: HTML principal que carga el bundle de Vite (`src/main.jsx`).
Content:

<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Link Tienda</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./src/main.jsx"></script>
  </body>
</html>

----------------------------------------
File: frontend/package.json
Path: frontend/package.json
Description: Configuraci√≥n de NPM/Vite para el frontend. Scripts: `dev`, `build`, `preview`. Dependencias principales: `react`, `react-dom`, `vite`.
Content:

{
  "name": "link-tienda-frontend",
  "version": "0.0.1",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "vite": "^5.0.0"
  }
}

----------------------------------------
File: frontend/src/Admin.jsx
Path: frontend/src/Admin.jsx
Description: Componente React para crear p√°ginas: campos (title, content, promo, categor√≠as, im√°genes, contact info). Sube im√°genes a `backend/api/upload_images.php`, luego env√≠a JSON a `backend/api/pages.php`.
Content (resumen):
- Control de estado para title, content, promo, images, categories, contact
- Funci√≥n `uploadImages()` que hace POST multipart a `upload_images.php`
- `handleSubmit()` construye payload con campos y `images` (URLs devueltas) y POST a `pages.php`.

(El archivo contiene un formulario completo y manejo de respuestas y mensajes.)

----------------------------------------
File: frontend/src/App.jsx
Path: frontend/src/App.jsx
Description: Punto principal del frontend. Carga listado de p√°ginas desde `backend/api/pages.php`. Muestra enlaces de navegaci√≥n y alterna entre `PageViewer` por `slug` y el panel `Admin` seg√∫n la query string.
Content (resumen):
- `useEffect` que fetch `pages.php` y guarda en `pages`
- Si existe `?slug=...` muestra `PageViewer` con ese slug, sino muestra `Admin`

----------------------------------------
File: frontend/src/main.jsx
Path: frontend/src/main.jsx
Description: Entrada de React que monta `App` en el `div#root`.
Content:

import React from 'react'
import { createRoot } from 'react-dom/client'
import App from './App'
import './styles.css'

createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)

----------------------------------------
File: frontend/src/PageViewer.jsx
Path: frontend/src/PageViewer.jsx
Description: Componente que muestra una p√°gina p√∫blica:
- Si recibe `slug` carga la p√°gina individual v√≠a `api/pages.php?slug=...` (devuelve `{ page }`).
- Carga productos desde `api/products.php` y los muestra en una lista simple.
- Muestra carousel de im√°genes, categor√≠as y datos de contacto.
Content (resumen): componente con `useEffect` para cargar p√°gina y productos; renderizado con `dangerouslySetInnerHTML` para `page.content`.

----------------------------------------
File: frontend/src/styles.css
Path: frontend/src/styles.css
Description: Estilos m√≠nimos globales, define la fuente base.
Content:

body { font-family: Arial, Helvetica, sans-serif; }

--- Notas sobre seguridad y despliegue ---
- Actualmente las credenciales DB est√°n hardcodeadas (host `127.0.0.1`, user `root`, pass ``). Para producci√≥n mover credenciales a un archivo de configuraci√≥n no p√∫blico o variables de entorno.
- CORS est√° configurado como `*` en varios endpoints; en producci√≥n restringir al dominio del frontend.
- `upload_images.php` guarda archivos en `backend/uploads/`; verificar permisos y validaci√≥n de tipos/tama√±os si se expone en producci√≥n.

--- Sugerencias / siguientes pasos ---
- Confirmar si quieres que genere `backend/config.example.php` con plantilla de conexi√≥n.
- Puedo crear un `deploy.sh` con pasos de export/import SQL si das acceso SSH o detalles.
- ¬øDeseas que haga commit del `chatgpt.txt` en el repo y cree un branch `docs/chatgpt-dump`?

--- Fin del volcado ---

(Archivo generado autom√°ticamente con el contenido leido en el workspace.)

--- Registro de sesi√≥n: cambios aplicados por el asistente durante esta interacci√≥n ---

Resumen de acciones realizadas y su impacto:

- Soporte de `page_type` (Producto/Servicio): se a√±adi√≥ UI y persistencia para distinguir p√°ginas que muestran inventario (productos) de p√°ginas que ofrecen servicios (turnos/reservas).
  Impacto: cambia la l√≥gica de admin y la vista p√∫blica; `ManagePage` decide qu√© manager mostrar (`InventoryManager` vs `ServicesManager`).

- Backend: nuevos y extendidos endpoints
  - `backend/api/inventory.php` ‚Äî gestiona `page_products` con columnas `category`, `on_sale`, `sale_price`, `featured`. Soporta create/update/delete y GET por `page_id` y `id`.
  - `backend/api/services.php` ‚Äî gestiona `page_services`, ahora con `category` y soporte CRUD.
  - `backend/api/availability.php` ‚Äî gestiona `service_turns` (turnos), valida solapamientos y respeta horarios de atenci√≥n (`open_time`/`close_time`).
  - `backend/api/reservations.php` ‚Äî gestiona `service_reservations`; a√±ade control de capacidad por turno, evita solapamientos por servicio y expone GET para listar reservas por `page_id`, `service_id`, `date`.
  - `backend/api/upload_logo.php` ‚Äî subida de logos; guarda en `backend/uploads/` y actualiza `pages.logo_url`.

- Frontend: cambios principales
  - `frontend/src/components/admin/adminApi.js`: central HTTP client con nuevos helpers (`getProduct`, `getService`, `createReservation`, `getReservations`, `uploadLogo`, etc.).
  - `InventoryManager.jsx` y `ServicesManager.jsx`: ahora reciben `categoryOptions` desde `ManagePage` y env√≠an `category` al backend al crear/editar.
  - `ServiceDetail.jsx`: vista p√∫blica de servicio con selecci√≥n de fecha; carga turnos, genera slots cuando no hay turnos expl√≠citos, consulta reservas y marca/deshabilita horarios ocupados (bot√≥n rojo, no seleccionable).
  - `App.jsx` y enrutamiento: se migr√≥ a `react-router`, con rutas limpias `/:storeSlug`, `/:storeSlug/service/:serviceId`, `/:storeSlug/product/:productId`.

- Migraciones y seguridad
  - Los endpoints intentan crear tablas y columnas faltantes con sentencias `CREATE TABLE IF NOT EXISTS` y `ALTER TABLE` protegidos, lo que facilita pruebas pero debe revisarse antes de producci√≥n.
  - CORS est√° abierto (`*`) y credenciales DB est√°n en claro ‚Äî mover a configuraci√≥n segura para producci√≥n.

Problemas diagnosticados y correcciones aplicadas:
- El frontend no mostraba horarios porque la UI cargaba la `page` y el `service` con as√≠ncron√≠a; se a√±adi√≥ efecto para recargar slots cuando `page` y `date` est√©n listos.
- Las reservas no actualizaban la UI inmediatamente: ahora tras una reserva exitosa la UI recarga slots y reservas.
- Inicialmente las comprobaciones de solapamiento en reservas bloqueaban por p√°gina (cualquier reserva en la p√°gina bloqueaba otros servicios); se ajust√≥ para comparar por `service_id` (solo reservas del mismo servicio bloquean).

Pruebas sugeridas (paso a paso):
1. Entra al admin y crea una p√°gina de tipo `Servicio` con `open_time` y `close_time` y al menos un `service` con `duration_minutes`.
2. En `Availability` crea un `turn` con `capacity` (p. ej. 2) para la fecha de prueba.
3. En la vista p√∫blica, selecciona la fecha y confirma que:
   - aparecen botones de horarios generados o desde `service_turns`;
   - si hay reservas, los horarios aparecen en rojo y no son seleccionables;
   - al reservar, la UI recarga y marca el slot ocupado (contador y color).

Notas finales y pr√≥ximos pasos posibles:
- Puedo eliminar las salidas de depuraci√≥n que a√±adimos (`debugResp`, `reservedMap` visibles) cuando confirmes que todo funciona.
- Puedo a√±adir un tooltip con nombres de reserva o una ventana modal que muestre detalles de las reservas por horario.
- Puedo consolidar la l√≥gica de generaci√≥n de slots en el backend (`availability.php`) si prefieres centralizar reglas y facilitar clientes ligeros.

Si quer√©s, hago commit de este `chatgpt.txt` actualizado en un branch `docs/chatgpt-dump` y preparo un resumen en `README.md` m√°s breve. Indica si quer√©s que proceda con el commit. 

--- Fin del registro de sesi√≥n ---
